import{S as d,u as R,b as T,r as m,j as e,s as v}from"./main-B3_jEoeY.js";import{B as h}from"./Button-L0Fi6IqF.js";import{b as j}from"./modals-TsjLAw3u.js";const k=2,t={version:k,players:[],format:"americano",courts:2,scoringMode:"total",pointsPerMatch:24,rankingCriteria:"points",courtFormat:"court",customCourtNames:[],maxRepeats:99,pairingStrategy:"optimal",preferredPartners:[],manualByes:[],hideLeaderboard:!0,showPositionChanges:!0,gridColumns:0,textSize:100,bracketScale:100,isLocked:!1,tournamentName:"",tournamentNotes:"",schedule:[],currentRound:0,leaderboard:[],allRounds:null,maxCourts:2,bracket:{format:"single",teams:[],matches:[],standings:[],meta:{name:"",notes:"",createdAt:null}},winnersCourt:null,ui:{currentRoute:"",selectedMatchId:null,activeBracketTab:"A"}},i=[],L=20;function I(){const n=document.getElementById("undoBtn");n&&(n.disabled=i.length===0)}function z(){const n=JSON.parse(JSON.stringify(t));i.push(n),i.length>L&&i.shift(),I()}const H="tournament-state";function _(){d.setItem(H,{version:t.version,players:t.players,format:t.format,courts:t.courts,scoringMode:t.scoringMode,pointsPerMatch:t.pointsPerMatch,rankingCriteria:t.rankingCriteria,courtFormat:t.courtFormat,customCourtNames:t.customCourtNames,maxRepeats:t.maxRepeats,pairingStrategy:t.pairingStrategy,preferredPartners:t.preferredPartners,tournamentName:t.tournamentName,tournamentNotes:t.tournamentNotes,schedule:t.schedule,currentRound:t.currentRound,leaderboard:t.leaderboard,allRounds:t.allRounds,isLocked:t.isLocked,hideLeaderboard:t.hideLeaderboard,manualByes:t.manualByes,gridColumns:t.gridColumns,textSize:t.textSize,bracket:t.bracket,ui:t.ui,winnersCourt:t.winnersCourt})}const y="padel_history_v1",A=20;function p(){return d.getItem(y,[])||[]}function P(n){const a=p(),s={id:Date.now().toString(),savedAt:new Date().toISOString(),summary:{date:new Date().toISOString(),name:n.tournamentName||"",notes:n.tournamentNotes||"",format:n.format,version:n.version,winner:n.leaderboard[0]?.name||"Unknown",playerCount:n.players.length,roundCount:n.schedule.length},data:n};return a.unshift(s),a.length>A&&a.pop(),d.setItem(y,a),s}function B(n){const a=p(),s=a.findIndex(l=>l.id===n);return s===-1?!1:(a.splice(s,1),d.setItem(y,a),!0)}function E(){const n={name:t.tournamentName,format:t.format,players:t.players,schedule:t.schedule,leaderboard:t.leaderboard,exportedAt:new Date().toISOString()};return JSON.stringify(n,null,2)}const U=()=>{const{dispatch:n}=R(),a=T(),[s,l]=m.useState([]),[c,b]=m.useState("");m.useEffect(()=>{x()},[]);const x=()=>{const r=p();l(r)},S=r=>r.winnersCourt?"/tournament/winners-court":r.bracket?"/tournament/bracket":"/tournament/generator",w=r=>{j("Load Tournament",`This will overwrite your current progress with "${r.summary.name||"Untitled"}". Continue?`,"Load",()=>{n({type:"SET_STATE",payload:r.data}),v("Tournament loaded");const o=S(r.data);a(o)})},C=(r,o)=>{j("Delete History",`Are you sure you want to delete "${o||"this tournament"}"?`,"Delete",()=>{B(r),x(),v("Item deleted")},!0)},g=s.filter(r=>{const o=c.toLowerCase();return r.summary.name.toLowerCase().includes(o)||r.summary.winner.toLowerCase().includes(o)||r.summary.format.toLowerCase().includes(o)});return s.length===0?null:e.jsxs("section",{className:"history-section animate-fade-in",style:{padding:"0 var(--space-md)"},children:[e.jsxs("div",{className:"section-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"var(--space-md)"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"bold",color:"var(--text-primary)",marginBottom:"4px"},children:"Tournament History"}),e.jsxs("p",{style:{color:"var(--text-muted)",fontSize:"0.9rem"},children:["Your past ",s.length," tournaments"]})]}),e.jsx("div",{style:{position:"relative",width:"100%",maxWidth:"250px"},children:e.jsx("input",{type:"text",placeholder:"Search history...",className:"form-input",style:{width:"100%",padding:"8px 12px",borderRadius:"var(--radius-md)"},value:c,onChange:r=>b(r.target.value)})})]}),e.jsxs("div",{className:"history-table-wrapper",children:[e.jsxs("table",{className:"history-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Tournament"}),e.jsx("th",{children:"Format"}),e.jsx("th",{children:"Winner"}),e.jsx("th",{children:"Players"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(r.savedAt).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:r.summary.name||"Untitled Tournament"})}),e.jsxs("td",{style:{textTransform:"capitalize",color:"var(--text-muted)"},children:[r.summary.format,e.jsxs("span",{style:{marginLeft:"8px",fontSize:"0.75rem",background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:"4px"},children:["v",r.summary.version||1]})]}),e.jsx("td",{children:e.jsxs("span",{style:{color:"var(--accent-light)",fontWeight:500},children:["ðŸ† ",r.summary.winner]})}),e.jsxs("td",{style:{color:"var(--text-muted)"},children:[r.summary.playerCount," players Â· ",r.summary.roundCount," ","rounds"]}),e.jsx("td",{className:"text-right",children:e.jsxs("div",{className:"action-buttons desktop-only",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>w(r),children:"Load"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>{const o=E(),N=new Blob([o],{type:"application/json"}),f=URL.createObjectURL(N),u=document.createElement("a");u.href=f,u.download=`${r.summary.name||"tournament"}.json`,u.click(),URL.revokeObjectURL(f)},title:"Download CSV",children:"ðŸ“¥"}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>C(r.id,r.summary.name),style:{color:"var(--error)"},children:"Ã—"})]})})]},r.id))})]}),g.length===0&&e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"var(--text-muted)"},children:['No history found matching "',c,'"']})]})]})};export{U as H,_ as a,P as b,z as p,t as s};
