import{u as B,b as q,r as m,S as C,s as x,c as _,d as D,j as e,e as F}from"./main-B3_jEoeY.js";import{C as P,T as K}from"./TournamentNav-D0k2sZ-U.js";import{B as y}from"./Button-L0Fi6IqF.js";import{P as J}from"./PlayerList-DN7Jjs2L.js";import{b as Q}from"./modals-TsjLAw3u.js";import{a as X}from"./seo-B5O_zVxb.js";const Y=()=>{const{dispatch:i}=B(),p=q(),[a,n]=m.useState([]),[r,w]=m.useState(!1),[h,S]=m.useState(!1),[k,t]=m.useState(null),[u,g]=m.useState("random"),[N,W]=m.useState(!1);m.useEffect(()=>{const s=C.getItem("wc_setup_players");s&&Array.isArray(s)&&n(s);const d=C.getItem("wc_split_sides","false");w(d==="true"),W(!0)},[]),m.useEffect(()=>{N&&C.setItem("wc_setup_players",a)},[a,N]),m.useEffect(()=>{C.setItem("wc_split_sides",String(r))},[r]);const A=Math.max(1,Math.floor(a.length/4)),v=k||A,R=m.useCallback(s=>{if(a.some(l=>l.name.toLowerCase()===s.toLowerCase())){x("Player already exists!","error");return}const d={id:_(),name:s,skill:0,side:r?"A":null};n(l=>[...l,d]),x(`${s} added`,"success")},[a,r]),I=m.useCallback(s=>{n(d=>d.filter((l,c)=>c!==s))},[]),E=m.useCallback(()=>{n([]),x("Cleared all players")},[]),T=m.useCallback(s=>{const d=s.split(`
`);let l=0;const c=[...a];d.forEach(j=>{const f=j.split(":"),o=f[0].trim(),b=f[1]&&parseInt(f[1])||0;o&&!c.some(H=>H.name.toLowerCase()===o.toLowerCase())&&(c.push({id:_(),name:o,skill:b,side:r?"A":null}),l++)}),n(c),x(`Imported ${l} players`,"success")},[a,r]),L=m.useCallback(()=>{const s=[...a];u==="random"&&[...s].sort(()=>Math.random()-.5).forEach((j,f)=>{const o=s.find(b=>b.id===j.id);o&&(o.side=f%2===0?"A":"B")}),n(s);const d=s.filter(c=>c.side!=="B").length,l=s.filter(c=>c.side==="B").length;x(`Assigned: A (${d}) / B (${l})`,"success")},[a,u]),z=m.useCallback(s=>{n(d=>d.map(l=>l.id===s?{...l,side:l.side==="B"?"A":"B"}:l)),g("manual")},[]),M=m.useCallback(()=>{const s=a.filter(o=>o.side!=="B"),d=a.filter(o=>o.side==="B"),l=r?Math.floor(s.length/4):v,c=r?Math.floor(d.length/4):0;if(l===0&&c===0){x("Need at least 4 players to start","error");return}const j=a.map(o=>({id:o.id,name:o.name,skill:o.skill,side:o.side})),f={courtCountA:l,courtCountB:c,splitSides:r,twist:h};try{const o=D(j,f);i({type:"SET_WINNERS_COURT",winnersCourtState:o});const b=l+c;x(`Winners Court started with ${b} court(s)`,"success"),p("/tournament/winners-court")}catch(o){x(o.message||"Generation failed","error")}},[a,r,v,h,i,p]),O=s=>s?s==="A"?{background:"rgba(59, 130, 246, 0.2)",color:"var(--accent)",border:"1px solid var(--accent)"}:{background:"rgba(245, 158, 11, 0.2)",color:"var(--warning)",border:"1px solid var(--warning)"}:{background:"rgba(255,255,255,0.1)",color:"var(--text-muted)",border:"1px solid var(--border-color)"},U=s=>r?e.jsx("button",{onClick:()=>z(s.id),style:{...O(s.side),fontSize:"0.7rem",fontWeight:600,padding:"2px 8px",borderRadius:"4px",cursor:"pointer",marginRight:"8px"},children:s.side==="B"?"Pool B":"Pool A"}):null,V=r?[...a].sort((s,d)=>s.side===d.side?0:s.side==="B"?1:-1):a,G=()=>{const s=a.length;if(s<4)return`Add at least ${4-s} more player${4-s>1?"s":""}`;if(r){const d=a.filter(c=>c.side!=="B").length,l=a.filter(c=>c.side==="B").length;return e.jsxs("span",{style:{color:"var(--success)"},children:["✓ ",s," ready | A: ",d," | B: ",l]})}return e.jsxs("span",{style:{color:"var(--success)"},children:["✓ ",s," players ready (",v," court",v>1?"s":"",")"]})};return e.jsxs("div",{className:"tournament-setup-view container animate-fade-in py-8",children:[e.jsxs("div",{className:"page-intro-header",children:[e.jsx("h2",{children:"Winners Court Setup"}),e.jsx("p",{children:"Skill-based court promotion. Win to move up, lose to move down."})]}),e.jsxs("div",{className:"setup-layout",children:[e.jsx(P,{className:"setup-layout__main",children:e.jsx(J,{items:V,onAdd:R,onRemove:I,onClear:E,onImport:T,renderPrefix:U,defaultView:"grid",showViewToggle:!0,hintText:e.jsxs("div",{className:"text-xs text-text-muted mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-brand-primary",children:"✓"}),G()]})})}),e.jsxs(P,{className:"setup-layout__sidebar",children:[e.jsx("h3",{className:"text-lg font-bold mb-4 border-b border-white/10 pb-2",children:"Settings"}),e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium text-text-muted",children:"Courts"}),e.jsxs("select",{className:"form-select bg-black/20 border-white/10 rounded-lg p-2 text-sm",value:v,onChange:s=>t(parseInt(s.target.value)),children:[e.jsxs("option",{value:A,children:["Auto (",A,")"]}),[1,2,3,4,5,6,7,8].map(s=>e.jsxs("option",{value:s,children:[s," Courts"]},s))]})]}),e.jsxs("div",{className:"bg-black/20 p-3 rounded-lg border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Twist Mode"}),e.jsx("div",{className:`ui-toggle scale-90 ${h?"active":""}`,onClick:()=>S(!h),children:e.jsx("div",{className:"toggle-track",children:e.jsx("div",{className:"toggle-thumb"})})})]}),e.jsx("p",{className:"text-xs text-text-muted",children:"Partners swap after every round (Winners split, Losers split)."})]}),e.jsxs("div",{className:"bg-black/20 p-3 rounded-lg border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Split Pools"}),e.jsx("div",{className:`ui-toggle scale-90 ${r?"active":""}`,onClick:()=>w(!r),children:e.jsx("div",{className:"toggle-track",children:e.jsx("div",{className:"toggle-thumb"})})})]}),e.jsx("p",{className:"text-xs text-text-muted",children:"Create separate A & B pools."})]}),r&&e.jsxs("div",{className:"animate-fade-in flex flex-col gap-3 pt-2 border-t border-white/10",children:[e.jsx("label",{className:"text-xs font-bold text-text-muted uppercase",children:"Pool Assignment"}),e.jsx("div",{className:"flex bg-black/30 p-1 rounded-lg",children:[{value:"random",label:"Random"},{value:"manual",label:"Manual"}].map(s=>e.jsx("div",{className:`flex-1 text-center text-xs py-1.5 rounded cursor-pointer transition-colors ${u===s.value?"bg-accent text-white shadow-sm":"text-text-muted hover:text-white"}`,onClick:()=>g(s.value),children:s.label},s.value))}),e.jsx(y,{size:"sm",variant:"secondary",onClick:L,className:"w-full text-xs",children:"Assign Pools"})]}),e.jsx(y,{size:"lg",disabled:a.length<4,onClick:M,className:"mt-2 w-full shadow-lg shadow-accent/20",children:"Start Session"})]})]})]}),e.jsx("div",{className:"mt-12 text-center text-xs text-text-muted opacity-50",children:"Winners move towards Court 1. Losers move towards last court."})]})},$=({court:i,twist:p,round:a,onSelectWinner:n,readOnly:r=!1})=>{const w=i.winner!=null,h=!r;return e.jsxs("div",{className:`wc-court ${w?"complete":""} ${h?"interactive":""}`,children:[e.jsxs("div",{className:"wc-court-header",children:["Court ",i.id]}),e.jsxs("div",{className:"wc-court-body-horizontal",children:[e.jsxs("div",{className:`wc-team-horizontal wc-team1 ${i.winner===1?"winner":i.winner===2?"loser":""}`,onClick:()=>h&&n?.(1),children:[e.jsx("div",{className:"wc-player-name",children:i.team1[0]?.name||"?"}),e.jsx("div",{className:"wc-player-name",children:i.team1[1]?.name||"?"})]}),e.jsx("div",{className:"wc-vs-horizontal",children:"VS"}),e.jsxs("div",{className:`wc-team-horizontal wc-team2 ${i.winner===2?"winner":i.winner===1?"loser":""}`,onClick:()=>h&&n?.(2),children:[e.jsx("div",{className:"wc-player-name",children:i.team2[0]?.name||"?"}),e.jsx("div",{className:"wc-player-name",children:i.team2[1]?.name||"?"})]})]})]})},Z=()=>{const{state:i,dispatch:p}=B(),a=i.winnersCourt;if(!a||!a.sides)return null;const{sides:n,twist:r}=a,w=Object.keys(n).filter(t=>n[t]?.courts?.length>0),h=t=>{if(!F(a,t)){x("Not all courts have results","error");return}p({type:"ADVANCE_WC_ROUND",side:t}),x(`Side ${t} - Round ${n[t].round+1} started`)},S=t=>{Q(`Clear Side ${t}?`,"This will reset this side.","Clear",()=>{p({type:"CLEAR_WC_SIDE",side:t}),x(`Side ${t} cleared`)})},k=(t,u,g)=>{p({type:"UPDATE_WC_RESULT",side:t,courtIndex:u,winner:g})};return e.jsxs("div",{className:"winners-court-active animate-fade-in p-4 sm:p-8",children:[e.jsxs("div",{className:"page-intro-header text-center max-w-[600px] mx-auto mb-8",children:[e.jsx("h2",{className:"text-3xl mb-1 text-white",children:"Winners Court"}),e.jsx("p",{className:"text-text-muted",children:"Promotion and relegation based on wins."})]}),e.jsx("div",{className:"flex gap-8 flex-wrap justify-center",children:w.map(t=>e.jsxs("div",{className:"wc-side-view flex-1 min-w-[320px] max-w-[600px]",children:[e.jsxs(P,{className:`p-4 border-2 ${t==="A"?"border-accent/40":"border-warning/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:`text-xl font-bold ${t==="A"?"text-accent":"text-warning"}`,children:["Side ",t," — Round ",n[t].round]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{size:"sm",variant:"secondary",onClick:()=>h(t),children:"Next Round"}),e.jsx(y,{size:"sm",variant:"danger",onClick:()=>S(t),children:"Clear"})]})]}),r&&e.jsx("div",{className:"text-xs text-text-muted italic mb-4",children:"Twist Mode Active"}),e.jsx("div",{className:"wc-courts-grid grid gap-4",children:n[t].courts.map((u,g)=>e.jsx($,{court:u,twist:r,round:n[t].round,onSelectWinner:N=>k(t,g,N)},u.id))})]}),n[t].history&&n[t].history.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h4",{className:"text-sm font-bold text-text-muted mb-4 uppercase tracking-wider",children:"Previous Rounds"}),e.jsx("div",{className:"flex flex-col gap-8 opacity-60",children:[...n[t].history].reverse().map(u=>e.jsxs("div",{className:"wc-history-round",children:[e.jsxs("div",{className:"text-xs text-text-muted mb-2",children:["Round ",u.round]}),e.jsx("div",{className:"grid gap-2 scale-90 origin-top-left",children:u.courts.map(g=>e.jsx($,{court:g,twist:r,round:u.round,readOnly:!0},g.id))})]},u.round))})]})]},t))})]})},le=()=>{const{state:i}=B(),p=i.winnersCourt&&i.winnersCourt.sides&&Object.keys(i.winnersCourt.sides).length>0;return m.useEffect(()=>X({title:"Winners Court Padel Format | King of the Hill",description:"Run Winners Court padel tournaments with automatic court movement, live scoring, and quick setup for club nights.",canonical:"https://padelcompanion.se/tournament/winners-court",ogUrl:"https://padelcompanion.se/tournament/winners-court"}),[]),e.jsxs("div",{className:"winners-court-page tournament-page",children:[e.jsx(K,{}),p?e.jsx(Z,{}):e.jsx(Y,{})]})};export{le as default};
