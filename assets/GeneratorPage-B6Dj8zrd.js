var ee=Object.defineProperty;var te=(t,s,r)=>s in t?ee(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var E=(t,s,r)=>te(t,typeof s!="symbol"?s+"":s,r);import{j as e,r as T,s as k,g as se,a as ae,u as $,c as z}from"./main-B3_jEoeY.js";import{C as G,T as ne}from"./TournamentNav-D0k2sZ-U.js";import{B as D}from"./Button-L0Fi6IqF.js";import{P as re}from"./PlayerList-DN7Jjs2L.js";import{s as h,p as le,a as ie,b as oe,H as ce}from"./HistorySection-QJJ7nwjg.js";import{s as de,a as me,b as _,c as ue}from"./modals-TsjLAw3u.js";import{a as he}from"./seo-B5O_zVxb.js";function pe(){const t=[...h.players],s=t.length,r=h.courts;s%2!==0&&t.push({id:-1,name:"BYE",isBye:!0});const c=t.length,m=[],b=t[0],x=t.slice(1);for(let a=0;a<c-1;a++){const u=[b,...x],g=[];for(let o=0;o<c/2;o++){const y=u[o],n=u[c-1-o];!y.isBye&&!n.isBye&&g.push([y,n])}const v=[],N=new Set;for(let o=0;o<g.length-1;o+=2)g[o]&&g[o+1]&&(v.push({court:Math.floor(o/2)+1,team1:g[o],team2:g[o+1]}),g[o].forEach(y=>N.add(y.id)),g[o+1].forEach(y=>N.add(y.id)));const w=v.slice(0,r),i=new Set;w.forEach(o=>{o.team1.forEach(y=>i.add(y.id)),o.team2.forEach(y=>i.add(y.id))});const d=h.players.filter(o=>!o.isBye&&!i.has(o.id));w.length>0&&m.push({number:m.length+1,matches:w,byes:d}),x.unshift(x.pop())}return m}function xe(){const t=[...h.players],s=t.length,r=h.courts;s%2!==0&&t.push({id:-1,name:"BYE",isBye:!0});const c=t.length,m=[],b=t[0],x=t.slice(1);for(let a=0;a<c-1;a++){const u=[b,...x],g=[],v=new Set;for(let d=0;d<c/2;d++){const o=u[d],y=u[c-1-d];!o.isBye&&!y.isBye&&(g.push({court:g.length+1,team1:[o],team2:[y]}),v.add(o.id),v.add(y.id))}const N=g.slice(0,r),w=new Set;N.forEach(d=>{d.team1.forEach(o=>w.add(o.id)),d.team2.forEach(o=>w.add(o.id))});const i=h.players.filter(d=>!d.isBye&&!w.has(d.id));N.length>0&&m.push({number:m.length+1,matches:N,byes:i}),x.unshift(x.pop())}return m}const F={format:[{value:"americano",label:"Americano"},{value:"mexicano",label:"Mexicano"},{value:"team",label:"Team"},{value:"teamMexicano",label:"Team Mex"}],scoringMode:[{value:"total",label:"Total Points"},{value:"race",label:"Race to"},{value:"time",label:"Timed"}],maxRepeats:[{value:0,label:"No repeats"},{value:1,label:"Max 1x"},{value:2,label:"Max 2x"},{value:3,label:"Max 3x"},{value:99,label:"Unlimited"}],pairingStrategy:[{value:"optimal",label:"Optimal"},{value:"oneThree",label:"1&3 vs 2&4"},{value:"oneTwo",label:"1&2 vs 3&4"},{value:"oneFour",label:"1&4 vs 2&3"}],courtFormat:[{value:"number",label:"Numbered (1)"},{value:"court",label:"Court Label (Court 1)"},{value:"custom",label:"Custom Names"}]},ge=({config:t,playerCount:s,onChange:r})=>{const c=t.format==="mexicano"||t.format==="teamMexicano",m=Math.max(1,Math.floor(s/4)),b=(a,u,g,v)=>{const N=Math.min(v,Math.max(g,u));r(a,N)},x=()=>t.scoringMode==="time"?"Minutes":t.scoringMode==="race"?"Race to":"Total Points";return e.jsxs("div",{className:"config-grid",children:[e.jsxs("div",{className:"config-full-width",style:{marginBottom:"var(--space-sm)"},children:[e.jsx("label",{className:"config-label",style:{width:"100%",marginBottom:"8px",display:"block"},children:"Tournament Format:"}),e.jsx("div",{className:"format-grid",children:F.format.map(a=>e.jsx("div",{className:`segmented-option ${t.format===a.value?"selected":""}`,onClick:()=>r("format",a.value),children:a.label},a.value))})]}),e.jsx("div",{className:"config-spacer config-full-width",style:{borderBottom:"1px solid var(--border-color)",margin:"var(--space-sm) 0"}}),e.jsx(I,{label:"Courts",children:e.jsx(Z,{value:t.courts,min:1,max:m,onChange:a=>b("courts",a,1,m),disabledMax:t.courts>=m,maxTooltip:t.courts>=m?`Max courts for ${s} players`:void 0})}),e.jsx(I,{label:"Scoring",children:e.jsx("select",{className:"form-select w-full",style:{width:"100%",padding:"8px",borderRadius:"var(--radius-md)",background:"var(--input-bg)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},value:t.scoringMode,onChange:a=>r("scoringMode",a.target.value),children:F.scoringMode.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),e.jsx(I,{label:x(),children:e.jsx(Z,{value:t.pointsPerMatch,min:4,max:50,step:t.scoringMode==="time"?1:2,onChange:a=>b("pointsPerMatch",a,4,50)})}),c&&e.jsxs(e.Fragment,{children:[e.jsx(I,{label:"Repeats",children:e.jsx("select",{className:"form-select w-full",style:{width:"100%",padding:"8px",borderRadius:"var(--radius-md)",background:"var(--input-bg)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},value:t.maxRepeats,onChange:a=>r("maxRepeats",parseInt(a.target.value)),children:F.maxRepeats.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),e.jsx(I,{label:"Pairing",children:e.jsx("select",{className:"form-select w-full",style:{width:"100%",padding:"8px",borderRadius:"var(--radius-md)",background:"var(--input-bg)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},value:t.pairingStrategy,onChange:a=>r("pairingStrategy",a.target.value),children:F.pairingStrategy.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),e.jsx(I,{label:"Prioritize Pattern",children:e.jsx("div",{className:`ui-toggle ${t.strictStrategy?"active":""} ${t.pairingStrategy==="optimal"?"disabled":""}`,onClick:()=>{t.pairingStrategy!=="optimal"&&r("strictStrategy",!t.strictStrategy)},children:e.jsx("div",{className:"toggle-track",children:e.jsx("div",{className:"toggle-thumb"})})})})]}),e.jsx("div",{className:"config-spacer config-full-width",style:{borderBottom:"1px solid var(--border-color)",margin:"var(--space-sm) 0"}}),e.jsx(I,{label:"Court Naming",children:e.jsx("select",{className:"form-select w-full",style:{width:"100%",padding:"8px",borderRadius:"var(--radius-md)",background:"var(--input-bg)",color:"var(--text-primary)",border:"1px solid var(--border-color)"},value:t.courtFormat,onChange:a=>r("courtFormat",a.target.value),children:F.courtFormat.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),t.courtFormat==="custom"&&e.jsx("div",{className:"config-full-width",children:e.jsx("div",{className:"custom-court-grid",children:Array.from({length:t.courts}).map((a,u)=>e.jsx("input",{type:"text",className:"custom-court-input",placeholder:`Court ${u+1} name...`,value:t.customCourtNames[u]||"",onChange:g=>{const v=[...t.customCourtNames];v[u]=g.target.value,r("customCourtNames",v)}},u))})})]})},I=({label:t,children:s})=>e.jsxs("div",{className:"config-row",children:[e.jsxs("label",{className:"config-label",children:[t,":"]}),e.jsx("div",{className:"config-input-wrapper",children:s})]}),Z=({value:t,min:s,max:r,step:c=1,onChange:m,disabledMax:b,maxTooltip:x})=>e.jsxs("div",{className:"ui-stepper",children:[e.jsx("button",{className:"stepper-btn",disabled:t<=s,onClick:()=>m(t-c),children:"âˆ’"}),e.jsx("div",{className:"stepper-input",children:t}),e.jsx("button",{className:"stepper-btn",disabled:b||t>=r,title:x,onClick:()=>m(t+c),children:"+"})]}),fe=({pairs:t,players:s,onAddPair:r,onRemovePair:c})=>{const[m,b]=T.useState(!1),[x,a]=T.useState(""),[u,g]=T.useState(""),v=i=>{const d=new Set;return t.forEach(o=>{d.add(o.player1Id),d.add(o.player2Id)}),s.filter(o=>!d.has(o.id)||o.id===i)},N=()=>{x&&u&&x!==u&&(r(x,u),a(""),g(""),b(!1))},w=i=>s.find(d=>d.id===i)?.name||"Unknown";return e.jsxs("div",{className:"preferred-partners mt-4 border-t border-white/10 pt-4",children:[!m&&t.length===0&&e.jsx("div",{className:"text-center",children:e.jsx(D,{variant:"secondary",size:"sm",onClick:()=>b(!0),children:"+ Add Fixed Pair"})}),(m||t.length>0)&&e.jsxs("div",{className:"bg-bg-tertiary rounded p-4 border border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-sm font-bold text-text-secondary uppercase tracking-wider",children:"Fixed Pairs"}),!m&&e.jsx(D,{size:"sm",variant:"secondary",onClick:()=>b(!0),children:"Add"})]}),t.length>0&&e.jsx("ul",{className:"mb-4 space-y-2",children:t.map(i=>e.jsxs("li",{className:"flex justify-between items-center bg-black/20 p-2 rounded px-3",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-300",children:[w(i.player1Id)," &"," ",w(i.player2Id)]}),e.jsx("button",{className:"text-text-muted hover:text-red-400 font-bold",onClick:()=>c(i.id),children:"âœ•"})]},i.id))}),m&&e.jsxs("div",{className:"bg-black/20 p-3 rounded border border-white/10 animate-fade-in shadow-lg",children:[e.jsxs("div",{className:"flex gap-2 items-center mb-3",children:[e.jsxs("select",{className:"flex-1 bg-white/5 text-sm p-2 rounded border border-white/10 outline-none",value:x,onChange:i=>a(i.target.value),children:[e.jsx("option",{value:"",children:"Select Player 1..."}),v(x).filter(i=>i.id!==u).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("span",{className:"text-text-muted font-bold",children:"&"}),e.jsxs("select",{className:"flex-1 bg-white/5 text-sm p-2 rounded border border-white/10 outline-none",value:u,onChange:i=>g(i.target.value),children:[e.jsx("option",{value:"",children:"Select Player 2..."}),v(u).filter(i=>i.id!==x).map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{size:"sm",variant:"ghost",onClick:()=>b(!1),children:"Cancel"}),e.jsx(D,{size:"sm",disabled:!x||!u,onClick:N,children:"Confirm Pair"})]})]})]})]})};let P=null,S=null,M=0,A=0,U=[],O=null,B=!1;const J=["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722"];function K(t,s){return Math.floor(Math.random()*(s-t+1)+t)}class be{constructor(){E(this,"x");E(this,"y");E(this,"r");E(this,"d");E(this,"color");E(this,"tilt");E(this,"tiltAngleIncremental");E(this,"tiltAngle");this.x=Math.random()*M,this.y=Math.random()*A-A,this.r=K(10,30),this.d=Math.random()*150+10,this.color=J[K(0,J.length-1)],this.tilt=Math.floor(Math.random()*10)-10,this.tiltAngleIncremental=Math.random()*.07+.05,this.tiltAngle=0}draw(){S&&(S.beginPath(),S.lineWidth=this.r/2,S.strokeStyle=this.color,S.moveTo(this.x+this.tilt+this.r/4,this.y),S.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),S.stroke())}}function X(){if(!(!B||!S)){S.clearRect(0,0,M,A);for(const t of U)t.draw();ye(),O=requestAnimationFrame(X)}}function ye(){for(let t=0;t<U.length;t++){const s=U[t];s.tiltAngle+=s.tiltAngleIncremental,s.y+=(Math.cos(s.d)+3+s.r/2)/2,s.tilt=Math.sin(s.tiltAngle-t/3)*15,(s.x>M+20||s.x<-20||s.y>A)&&B&&(s.x=Math.random()*M,s.y=-10,s.tilt=Math.floor(Math.random()*10)-10)}}function ve(){if(!B){P||(P=document.createElement("canvas"),P.id="confetti-canvas",P.style.position="fixed",P.style.top="0",P.style.left="0",P.style.width="100%",P.style.height="100%",P.style.pointerEvents="none",P.style.zIndex="9999",document.body.appendChild(P),S=P.getContext("2d")),M=window.innerWidth,A=window.innerHeight,P.width=M,P.height=A,window.addEventListener("resize",()=>{M=window.innerWidth,A=window.innerHeight,P&&(P.width=M,P.height=A)}),B=!0,U=[];for(let t=0;t<150;t++)U.push(new be);X()}}function je(){B=!1,S&&S.clearRect(0,0,M,A),O&&cancelAnimationFrame(O),P&&P.remove(),P=null}function Ne(){ve(),setTimeout(je,5e3)}function we(){const t=h.format==="team"||h.format==="teamMexicano",s=t?2:4;if(h.players.length<s)return k(`Not enough ${t?"teams":"players"} (min ${s})`,"error"),Promise.resolve();h.currentRound=1;const r=h.format==="team"||h.format==="teamMexicano"?2:4,c=Math.floor(h.players.length/r),m=()=>{le(),h.leaderboard=h.players.map(b=>({...b,points:0,wins:0,losses:0,pointsLost:0,played:0,byeCount:0,playedWith:[]})),h.format==="americano"?(h.allRounds=pe(),h.schedule=[h.allRounds[0]]):h.format==="team"?(h.allRounds=xe(),h.schedule=[h.allRounds[0]]):h.format==="teamMexicano"?(h.schedule=se(h.players,h.courts),h.allRounds=null):(h.schedule=ae(h.players,h.courts,h.preferredPartners),h.allRounds=null),h.isLocked=!0,ie(),k("ðŸŽ¾ Tournament started! Round 1 ready")};if(h.courts>c){if(c===0)return de("Not Enough Players",`You need at least ${r} players/teams to start!`),Promise.resolve();const b=h.courts;h.courts=c,k(`Adjusted courts: ${b} â†’ ${c}`)}return me().then(()=>(m(),{schedule:h.schedule,allRounds:h.allRounds,leaderboard:h.leaderboard,currentRound:h.currentRound,isLocked:h.isLocked}))}const Ce=({onGameActive:t})=>{const{state:s,dispatch:r}=$(),{players:c,preferredPartners:m,format:b,courts:x,scoringMode:a,pointsPerMatch:u,maxRepeats:g,pairingStrategy:v,strictStrategy:N}=s;T.useEffect(()=>{Object.assign(h,s)},[s]);const w=n=>{if(c.some(p=>p.name.toLowerCase()===n.toLowerCase())){k("Player already exists","error");return}const l={id:z(),name:n,lockedCourt:null};r({type:"ADD_PLAYER",player:l}),k(`${n} added`,"success")},i=async()=>{if(c.length<4){k("Need at least 4 players","error");return}try{Object.assign(h,s),console.log("[Generator] Pre-generation State:",{players:s.players.length,courts:s.courts,format:s.format,legacyCourts:h.courts});const n=await we();if(!n)return;const l=n.schedule||[],p=l.filter(f=>f&&f.matches&&f.matches.length>0);if(l.length>0&&p.length===0){k("Error: Generated schedule has empty rounds.","error");return}r({type:"SET_STATE",payload:{schedule:l.length>0?[...l]:[],leaderboard:n.leaderboard?[...n.leaderboard]:[],allRounds:n.allRounds?[...n.allRounds]:null,currentRound:n.currentRound,isLocked:n.isLocked}}),p.length>0&&t()}catch(n){k(n.message||"Generation failed","error")}},d=(n,l)=>{r({type:"UPDATE_FIELD",key:n,value:l})},o=n=>s.courtFormat==="custom"&&s.customCourtNames[n-1]?s.customCourtNames[n-1]:s.courtFormat==="number"?n.toString():`Court ${n}`,y=(n,l)=>x<=1?null:e.jsxs("select",{className:"court-lock-select bg-black/20 text-xs p-1 rounded border border-white/10 outline-none",value:n.lockedCourt||"",onChange:p=>{const f=p.target.value?parseInt(p.target.value):null,R=[...c];R[l]={...R[l],lockedCourt:f},r({type:"SET_STATE",payload:{players:R}})},title:"Lock to Court",children:[e.jsx("option",{value:"",children:"Auto"}),Array.from({length:x},(p,f)=>f+1).map(p=>e.jsx("option",{value:p,children:o(p)},p))]});return e.jsxs("div",{className:"tournament-setup-view container animate-fade-in",children:[e.jsxs("div",{className:"page-intro-header",children:[e.jsx("h2",{children:"Americano Setup"}),e.jsx("p",{children:"Add players and configure your tournament settings."})]}),e.jsxs("div",{className:"setup-grid",children:[e.jsx("div",{className:"setup-main",children:e.jsx(G,{children:e.jsx(re,{items:c,onAdd:w,onRemove:n=>{r({type:"REMOVE_PLAYER",playerId:c[n].id})},onClear:()=>r({type:"CLEAR_PLAYERS"}),onImport:n=>{const l=n.split(`
`),p=[];l.forEach(f=>{const R=f.trim();R&&!c.some(L=>L.name.toLowerCase()===R.toLowerCase())&&p.push({id:z(),name:R,lockedCourt:null})}),r({type:"SET_STATE",payload:{players:[...c,...p]}}),k(`Imported ${p.length} players`,"success")},renderActions:y,onReorder:(n,l)=>{const p=[...c],[f]=p.splice(n,1);p.splice(l,0,f),r({type:"SET_STATE",payload:{players:p}})},hintText:e.jsxs("div",{className:"text-xs text-text-muted mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-brand-primary",children:"âœ“"}),e.jsxs("span",{children:[c.length," ready"]}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsxs("span",{children:[x," courts (",x*4," players ideal)"]}),c.length%4!==0&&e.jsx("span",{className:"text-warning ml-1",children:"(Queue enabled)"})]})})})}),e.jsxs("div",{className:"setup-sidebar",children:[e.jsxs(G,{children:[e.jsx(ge,{config:{format:s.format,courts:s.courts,scoringMode:s.scoringMode,pointsPerMatch:s.pointsPerMatch,maxRepeats:s.maxRepeats,pairingStrategy:s.pairingStrategy,strictStrategy:s.strictStrategy,courtFormat:s.courtFormat,customCourtNames:s.customCourtNames},playerCount:c.length,onChange:d}),e.jsx(D,{size:"lg",disabled:c.length<4,onClick:i,className:"w-full mt-4",children:"Generate Schedule"})]}),b.includes("mexicano")&&e.jsx(G,{className:"mt-4",children:e.jsx(fe,{pairs:m,players:c,onAddPair:(n,l)=>{r({type:"UPDATE_FIELD",key:"preferredPartners",value:[...m,{id:z(),player1Id:n,player2Id:l}]})},onRemovePair:n=>{r({type:"UPDATE_FIELD",key:"preferredPartners",value:m.filter(l=>l.id!==n)})}})})]})]})]})},Re=()=>{const{state:t,dispatch:s}=$(),{leaderboard:r,rankingCriteria:c,hideLeaderboard:m,showPositionChanges:b,leaderboardColumns:x}=t,[a,u]=T.useState(""),[g,v]=T.useState(!1),[N,w]=T.useState(typeof window<"u"?window.innerWidth<800:!1);T.useEffect(()=>{const f=()=>{w(window.innerWidth<800)};return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const i=N?1:x||1,d=T.useMemo(()=>{const R=[...r].sort((j,C)=>{switch(c){case"wins":return C.wins!==j.wins?C.wins-j.wins:C.points!==j.points?C.points-j.points:C.points-(C.pointsLost||0)-(j.points-(j.pointsLost||0));case"winRatio":const W=j.played>0?j.wins/j.played:0,V=C.played>0?C.wins/C.played:0;return Math.abs(V-W)>.001?V-W:C.points-j.points;case"pointRatio":const Y=j.points+(j.pointsLost||0),H=C.points+(C.pointsLost||0),q=Y>0?j.points/Y:0,Q=H>0?C.points/H:0;return Math.abs(Q-q)>.001?Q-q:C.points-j.points;case"points":default:return C.points!==j.points?C.points-j.points:C.wins!==j.wins?C.wins-j.wins:C.points-(C.pointsLost||0)-(j.points-(j.pointsLost||0))}}).map((j,C)=>({...j,currentRank:C+1}));let L=R;if(m&&(L=[...R].sort((j,C)=>String(j.id).localeCompare(String(C.id)))),a.trim()){const j=a.toLowerCase().trim();L=L.filter(C=>C.name.toLowerCase().includes(j))}return L},[r,c,m,a]),o=T.useMemo(()=>g||a.trim()||d.length<=12||i>1?d:d.slice(0,10),[d,g,a,i]),y=()=>{s({type:"UPDATE_FIELD",key:"hideLeaderboard",value:!m})},n=()=>{s({type:"UPDATE_FIELD",key:"showPositionChanges",value:!b})},l=f=>{s({type:"UPDATE_FIELD",key:"rankingCriteria",value:f})},p=f=>{s({type:"UPDATE_FIELD",key:"leaderboardColumns",value:f})};return{sortedLeaderboard:o,totalCount:d.length,fullCount:m&&!a?r.length:d.length,rankingCriteria:c,hideLeaderboard:m,showPositionChanges:b,leaderboardColumns:i,searchQuery:a,setSearchQuery:u,isExpanded:g,setIsExpanded:v,toggleVisibility:y,toggleRanks:n,setCriteria:l,setLeaderboardColumns:p,isSmallScreen:N}},Pe=()=>{const{sortedLeaderboard:t,rankingCriteria:s,hideLeaderboard:r,showPositionChanges:c,leaderboardColumns:m,searchQuery:b,setSearchQuery:x,isExpanded:a,setIsExpanded:u,totalCount:g,toggleVisibility:v,toggleRanks:N,setCriteria:w,setLeaderboardColumns:i}=Re(),o=(()=>{const l=Math.max(1,m);if(l===1)return[t];if(b)return[t];const p=Math.ceil(t.length/l),f=[];for(let R=0;R<l;R++)f.push(t.slice(R*p,(R+1)*p));return f})(),y=o.length,n=l=>r?"":l===1?"rank-1":l===2?"rank-2":l===3?"rank-3":"";return e.jsxs("div",{className:`leaderboard-section ${y>1?"is-grid":""}`,children:[e.jsxs("div",{className:"leaderboard-header flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center w-full",children:[e.jsx("div",{className:"flex items-center gap-3 self-start sm:self-center",children:e.jsx("h3",{className:"text-2xl font-bold text-white tracking-wide whitespace-nowrap",children:"Leaderboard"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-center w-full sm:w-auto",children:[e.jsx("div",{className:"leaderboard-controls-group w-full sm:w-auto justify-center",children:[{id:"points",label:"Points"},{id:"wins",label:"Wins"},{id:"winRatio",label:"Win %"},{id:"pointRatio",label:"Pts %"}].map(l=>e.jsx("button",{className:`leaderboard-tab flex-1 sm:flex-initial ${s===l.id?"active":""}`,onClick:()=>w(l.id),children:l.label},l.id))}),e.jsxs("div",{className:"flex gap-3 items-center w-full sm:w-auto justify-center",children:[e.jsx("div",{className:"leaderboard-controls-group leaderboard-grid-selector flex",children:[1,2,3].map(l=>e.jsxs("button",{className:`leaderboard-tab ${m===l||l===1&&!m?"active":""}`,onClick:()=>i(l),title:`${l} Column${l>1?"s":""}`,children:[l," col"]},l))}),e.jsxs("div",{className:"leaderboard-actions",children:[e.jsx("button",{className:`leaderboard-action-btn ${r?"":"active"}`,onClick:v,title:"Toggle Scores",children:"Scores"}),e.jsx("button",{className:`leaderboard-action-btn ${c?"active":""}`,onClick:N,title:"Toggle Rank Changes",children:"Ranks"})]})]})]})]}),e.jsxs("div",{className:"leaderboard-search-container w-full",children:[e.jsx("span",{className:"search-icon",children:"ðŸ”"}),e.jsx("input",{type:"text",className:"leaderboard-search-input",placeholder:"Search players...",value:b,onChange:l=>x(l.target.value)}),b&&e.jsx("button",{className:"search-clear",onClick:()=>x(""),children:"âœ•"})]})]}),e.jsx("div",{className:"leaderboard-grid-container",style:{"--cols":y},children:o.map((l,p)=>e.jsx("div",{className:"leaderboard-column",children:e.jsx("div",{className:"overflow-x-auto w-full",children:e.jsxs("table",{className:"leaderboard-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[60px] text-center sticky-col",children:"Rank"}),e.jsx("th",{className:"sticky-col",children:"Player"}),e.jsx("th",{className:"w-[12%] text-center",children:"Pts"}),e.jsx("th",{className:"w-[10%] text-center",children:"W"}),e.jsx("th",{className:"w-[12%] text-center",children:"Win%"}),e.jsx("th",{className:"w-[12%] text-center",children:"Pts%"}),e.jsx("th",{className:"w-[10%] text-center",children:"M"})]})}),e.jsx("tbody",{children:l.map(f=>{const R=f.currentRank,j=(f.previousRank||R)-R;f.points-(f.pointsLost||0);const C=n(R);return e.jsxs("tr",{className:C,children:[e.jsxs("td",{className:"rank-cell",children:[e.jsx("div",{className:"rank-badge",children:r?"-":R}),c&&e.jsxs("div",{className:`trend-indicator ${j>0?"trend-up":j<0?"trend-down":"trend-neutral"}`,children:[j>0?"â–²":j<0?"â–¼":"-",j!==0&&Math.abs(j)]})]}),e.jsx("td",{children:e.jsx("div",{className:"player-info",children:e.jsx("span",{className:"player-name truncate max-w-[120px] lg:max-w-xs",children:f.name})})}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"stat-value text-lg",children:r?"-":f.points})}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"stat-value dim",children:r?"-":f.wins})}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"stat-value dim",children:!r&&f.played>0?`${Math.round(f.wins/f.played*100)}%`:"-"})}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"stat-value dim",children:!r&&f.points+(f.pointsLost||0)>0?`${Math.round(f.points/(f.points+(f.pointsLost||0))*100)}%`:"-"})}),e.jsx("td",{className:"text-center",children:e.jsx("span",{className:"stat-value dim text-xs",children:!r||c?f.played:"-"})})]},f.id)})})]})})},p))}),!b&&g>10&&y===1&&e.jsx("div",{className:"p-2 border-t border-white/5 bg-black/5 text-center",children:e.jsx("button",{className:"btn btn-ghost btn-xs opacity-70 hover:opacity-100 normal-case gap-2",onClick:()=>u(!a),children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â–²"})," Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â–¼"})," Show more (",g-10," more players)"]})})}),e.jsxs("div",{className:"p-4 border-t border-white/5 flex justify-between items-center bg-black/10",children:[e.jsxs("span",{className:"text-[10px] uppercase tracking-widest opacity-30 font-bold ml-2",children:[g," Players"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-xs btn-outline btn-ghost opacity-60 hover:opacity-100",children:"Share Results"}),e.jsx("button",{className:"btn btn-xs btn-primary",children:"Print"})]})]})]})},Te=({round:t,roundIndex:s,isLast:r,onComplete:c,onEdit:m,onScoreChange:b,onToggleBye:x})=>{const{state:a}=$(),[u,g]=T.useState(t.completed&&!r),v=n=>a.courtFormat==="custom"&&a.customCourtNames[n-1]?a.customCourtNames[n-1]:`Court ${n}`,N=n=>n==="repeats"?"Repeat allowed (Priority: Pattern)":n==="pattern"?"Pattern override (Priority: Repeats)":"Constraint relaxed (Best effort)",w=()=>{let n=0;const l=[];return t.matches.forEach(p=>{p.score1!==void 0&&p.score1!==null&&p.score2!==void 0&&p.score2!==null?n++:l.push(v(p.court))}),n===0?{status:"empty",missing:l}:n===t.matches.length?{status:"complete",missing:[]}:{status:"partial",missing:l}},{status:i,missing:d}=w(),o=()=>{if(i==="complete")c();else if(i==="partial"){const n=`Missing scores for:
${d.map(l=>"â€¢ "+l).join(`
`)}

Continue anyway?`;_("Incomplete Round",n,"Continue Anyway",c)}else _("No Scores Entered","You haven't entered any scores for this round. Are you sure you want to complete it as all 0-0?","Complete w/ Zeros",c)},y=()=>i==="complete"?"btn-success":"bg-base-300 text-base-content/50 hover:bg-base-200 border-base-content/10";return e.jsxs("div",{className:`round ${t.completed?"completed":"ongoing"} ${u?"collapsed":""}`,id:`round-${s}`,children:[e.jsxs("div",{className:"round-header",onClick:()=>t.completed&&g(!u),children:[e.jsxs("span",{className:"round-title",children:["Round ",t.number,t.completed?e.jsx("span",{className:"round-status completed",children:"âœ“ Completed"}):e.jsx("span",{className:"round-status ongoing",children:"â— Ongoing"})]}),t.completed&&u&&e.jsx("span",{className:"round-summary",children:t.matches.map(n=>`${n.score1}-${n.score2}`).join(" Â· ")}),t.completed&&e.jsx("span",{className:"collapse-icon",children:u?"â–¶":"â–¼"})]}),e.jsxs("div",{className:"round-content",children:[e.jsx("div",{className:"matches-grid",style:{display:"grid",gridTemplateColumns:a.gridColumns>0?`repeat(${a.gridColumns}, minmax(0, 1fr))`:void 0,fontSize:`${a.textSize}%`,"--text-scale":a.textSize/100},children:t.matches.map((n,l)=>e.jsxs("div",{className:"match-card-wrapper",children:[e.jsxs("div",{className:"match-card-header",children:[e.jsx("span",{className:"court-label",children:v(n.court)}),e.jsx("span",{className:"match-info-sub",children:a.scoringMode==="total"?`Total ${a.pointsPerMatch}`:a.scoringMode==="race"?`Race to ${a.pointsPerMatch}`:`${a.pointsPerMatch} mins`}),n.relaxedConstraint&&e.jsx("span",{className:"constraint-badge",title:N(n.relaxedConstraint),children:"i"})]}),e.jsx("div",{className:"match-card",children:e.jsxs("div",{className:"match-teams",children:[e.jsx("div",{className:"team",children:n.team1.map(p=>e.jsx("span",{children:p.name},p.id))}),e.jsx("div",{className:"team",children:n.team2.map(p=>e.jsx("span",{children:p.name},p.id))})]})}),e.jsx("div",{className:"match-card-footer",children:t.completed?e.jsxs("div",{className:"score-input-row",children:[e.jsxs("span",{className:"score-display",children:[n.score1," - ",n.score2]}),e.jsx("button",{className:"btn btn-sm btn-ghost edit-score-btn",onClick:m,children:"Edit"})]}):e.jsxs("div",{className:"score-input-row",children:[e.jsx("input",{type:"number",className:"score-input",placeholder:"0",value:n.score1??"",onChange:p=>b(l,1,parseInt(p.target.value)||0)}),e.jsx("span",{className:"score-separator",children:"-"}),e.jsx("input",{type:"number",className:"score-input",placeholder:"0",value:n.score2??"",onChange:p=>b(l,2,parseInt(p.target.value)||0)})]})})]},l))}),t.byes&&t.byes.length>0&&e.jsxs("div",{className:"waiting-players",children:[e.jsx("span",{className:"waiting-label",children:"Resting:"}),e.jsx("span",{className:"waiting-names",children:t.byes.map(n=>n.name).join(", ")})]}),!t.completed&&r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bye-selector",children:[e.jsxs("div",{className:"bye-selector-header",children:[e.jsx("span",{className:"bye-selector-label",children:"Toggle who rests next round:"}),e.jsxs("small",{className:"bye-hint",children:["(",a.manualByes.length," selected)"]})]}),e.jsx("div",{className:"bye-chips",children:a.leaderboard.map(n=>e.jsxs("button",{className:`bye-chip ${a.manualByes.includes(n.id)?"selected":""}`,onClick:()=>x(n.id),children:[n.name,e.jsxs("span",{className:"bye-count",children:["(",n.byeCount||0,")"]})]},n.id))})]}),e.jsxs("button",{className:`btn ${y()} complete-round-btn`,onClick:o,children:["Complete Round ",t.number]})]})]})]})},ke=()=>{const{state:t,dispatch:s}=$(),{schedule:r}=t,c=(a,u,g,v)=>{const N=[...r],w={...N[a].matches[u]};g===1?w.score1=v:w.score2=v,t.scoringMode==="total"&&(g===1?w.score2=t.pointsPerMatch-v:w.score1=t.pointsPerMatch-v),N[a].matches[u]=w,s({type:"UPDATE_FIELD",key:"schedule",value:N})},m=a=>{s({type:"COMPLETE_ROUND"})},b=a=>{s({type:"EDIT_ROUND",roundIndex:a})},x=a=>{const u=t.manualByes.includes(a)?t.manualByes.filter(g=>g!==a):[...t.manualByes,a];s({type:"UPDATE_FIELD",key:"manualByes",value:u})};return e.jsx("div",{className:"rounds-container",id:"roundsContainer",children:r.map((a,u)=>e.jsx(Te,{round:a,roundIndex:u,isLast:u===r.length-1,onComplete:()=>m(),onEdit:()=>b(u),onScoreChange:(g,v,N)=>c(u,g,v,N),onToggleBye:x},u))})},Se=()=>{const{state:t,dispatch:s}=$(),{timer:r,scoringMode:c}=t,[m,b]=T.useState(r.remainingSeconds),x=T.useRef(null),a=T.useRef(null);T.useEffect(()=>{b(r.remainingSeconds)},[r.remainingSeconds]),T.useEffect(()=>(r.isRunning&&r.status!=="completed"?x.current=setInterval(()=>{b(d=>d<=1?(u(),0):(d<=4&&i(440,.2),d-1))},1e3):x.current&&clearInterval(x.current),()=>{x.current&&clearInterval(x.current)}),[r.isRunning,r.status]),T.useEffect(()=>{const d=setTimeout(()=>{s({type:"UPDATE_TIMER",payload:{remainingSeconds:m}})},2e3);return()=>clearTimeout(d)},[m]);const u=()=>{s({type:"UPDATE_TIMER",payload:{isRunning:!1,status:"completed",remainingSeconds:0}}),i(880,1),k("TIME UP!","info"),document.title="TIME UP!",document.body.classList.add("timer-finished-flash"),setTimeout(()=>document.body.classList.remove("timer-finished-flash"),1e3)},g=()=>{if(r.status==="completed"){v();return}const d=!r.isRunning;s({type:"UPDATE_TIMER",payload:{isRunning:d,status:d?"running":"paused"}}),d&&i(880,.1)},v=()=>{const d=r.duration*60;b(d),s({type:"UPDATE_TIMER",payload:{isRunning:!1,status:"idle",remainingSeconds:d}}),document.title="Tournament"},N=d=>{b(o=>Math.max(0,o+d*60))},w=d=>{const o=Math.floor(d/60),y=d%60;return`${o.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`},i=(d,o)=>{try{a.current||(a.current=new(window.AudioContext||window.webkitAudioContext));const y=a.current;y.state==="suspended"&&y.resume();const n=y.createOscillator(),l=y.createGain();n.type="sine",n.frequency.value=d,n.connect(l),l.connect(y.destination),n.start(),l.gain.setValueAtTime(.1,y.currentTime),l.gain.exponentialRampToValueAtTime(.001,y.currentTime+o),n.stop(y.currentTime+o)}catch(y){console.warn("Audio failed",y)}};return c!=="time"?null:e.jsx("div",{className:`match-timer-container ${r.status}`,children:e.jsxs("div",{className:"timer-display-card",children:[e.jsxs("div",{className:"timer-header",children:[e.jsx("span",{className:"timer-label",children:"Match Clock"}),r.status==="running"&&e.jsx("span",{className:"live-badge",children:"LIVE"})]}),e.jsxs("div",{className:"timer-main",children:[e.jsx("button",{className:"timer-adjust",onClick:()=>N(-1),children:"âˆ’1"}),e.jsx("div",{className:"timer-digits",onClick:g,children:w(m)}),e.jsx("button",{className:"timer-adjust",onClick:()=>N(1),children:"+1"})]}),e.jsxs("div",{className:"timer-controls",children:[e.jsx(D,{variant:r.isRunning?"secondary":"primary",size:"sm",onClick:g,children:r.isRunning?"Pause":"Start"}),e.jsx(D,{variant:"ghost",size:"sm",onClick:v,children:"Reset"})]})]})})},Ee=()=>{const{state:t,dispatch:s}=$(),{tournamentName:r,format:c,courts:m,scoringMode:b,pointsPerMatch:x}=t;T.useEffect(()=>{window.scrollTo(0,0)},[]);const a=()=>{_("Reset Tournament","This will clear all scores and rounds. Players will remain. Continue?","Reset",()=>{s({type:"RESET_TOURNAMENT"}),k("Tournament reset")})},u=()=>{_("Finish Tournament","Are you sure you want to finish the tournament? This will reveal the final standings and save it to history!","Finish & Celebrate ðŸŽ‰",()=>{s({type:"UPDATE_FIELD",key:"hideLeaderboard",value:!1}),s({type:"UPDATE_FIELD",key:"showPositionChanges",value:!1}),oe(t),Ne();const i=document.querySelector(".leaderboard-section");i&&i.scrollIntoView({behavior:"smooth",block:"center"}),k("Tournament Finished & Saved! ðŸ†")})},g=()=>{console.log("Undo not implemented yet in React")},v=()=>{const i=c.startsWith("team");ue(i?"Add Late Team":"Add Late Player",`Enter new ${i?"team":"player"} name:`,o=>{if(!o||!o.trim())return;const y=()=>{s({type:"ADD_LATE_PLAYER",player:{id:z(),name:o.trim(),lockedCourt:null}}),k(`${o.trim()} added to tournament`)};c==="americano"||c==="team"?_("Switch to Mexicano?","Adding a player mid-tournament requires switching to Mexicano (Dynamic) logic. Continue?","Switch & Add",()=>{s({type:"UPDATE_FIELD",key:"format",value:"mexicano"}),s({type:"UPDATE_FIELD",key:"allRounds",value:null}),y()}):y()},"They will join with 0 points and start playing from the next round.")},N={americano:"Americano",mexicano:"Mexicano",team:"Team Americano",teamMexicano:"Team Mexicano"}[c]||"Tournament",w={total:"Total Points",race:"Race to Points",time:"Time Based"}[b]||"Scoring";return e.jsxs("div",{className:"tournament-active-view container animate-fade-in",children:[e.jsx("header",{className:"tournament-active-header",children:e.jsxs("div",{className:"header-top",children:[e.jsxs("div",{className:"tournament-title-area",children:[e.jsx("h2",{children:r||"Live Tournament"}),e.jsxs("div",{className:"game-details",id:"gameDetails",children:[e.jsx("div",{className:"game-detail-item",children:e.jsx("span",{className:"detail-label",children:N})}),e.jsx("div",{className:"game-detail-item",children:e.jsxs("span",{className:"detail-label",children:[m," Courts"]})}),e.jsx("div",{className:"game-detail-item",children:e.jsx("span",{className:"detail-label",children:w})}),e.jsx("div",{className:"game-detail-item",children:e.jsx("span",{className:"detail-label",children:b==="time"?`${x} Mins`:`${x} Pts`})})]})]}),e.jsx(Se,{}),e.jsxs("div",{className:"bg-base-300/50 backdrop-blur-md border border-white/10 rounded-2xl p-4 mb-6 shadow-xl max-w-4xl mx-auto w-full",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center items-center mb-4",children:[e.jsxs("button",{className:"btn btn-sm btn-ghost gap-2 normal-case",onClick:g,title:"Undo last action",children:[e.jsx("span",{className:"icon",children:"â†©"})," Undo"]}),e.jsx("div",{className:"w-px h-6 bg-white/10 mx-2 hidden sm:block"}),e.jsxs("button",{className:"btn btn-sm btn-primary gap-2 normal-case shadow-lg shadow-primary/20",onClick:v,children:[e.jsx("span",{className:"icon text-lg",children:"+"})," Add Player"]}),e.jsx("div",{className:"flex-1"})," ",e.jsxs("button",{className:"btn btn-sm btn-ghost text-success hover:bg-success/10 gap-2 normal-case font-bold",onClick:u,children:[e.jsx("span",{className:"icon",children:"ðŸ†"})," Finish Tournament"]}),e.jsxs("button",{className:"btn btn-sm btn-ghost hover:bg-white/5 gap-2 normal-case opacity-70 hover:opacity-100",onClick:a,children:[e.jsx("span",{className:"icon",children:"ðŸ”„"})," Reset"]})]}),e.jsx("div",{className:"h-px bg-white/5 w-full mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-8 justify-center items-center text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-base-100/30 px-3 py-2 rounded-lg border border-white/5",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider opacity-60",children:"Grid"}),e.jsx("input",{type:"range",min:"0",max:"4",step:"1",className:"range range-xs range-secondary w-24",value:t.gridColumns,onChange:i=>s({type:"UPDATE_FIELD",key:"gridColumns",value:parseInt(i.target.value)})}),e.jsx("span",{className:"w-8 text-center font-mono text-xs bg-black/20 rounded px-1",children:t.gridColumns||"Auto"})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-base-100/30 px-3 py-2 rounded-lg border border-white/5",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider opacity-60",children:"Text Size"}),e.jsx("input",{type:"range",min:"50",max:"350",step:"10",className:"range range-xs range-secondary w-32",value:t.textSize,onChange:i=>s({type:"UPDATE_FIELD",key:"textSize",value:parseInt(i.target.value)})}),e.jsxs("span",{className:"w-10 text-center font-mono text-xs bg-black/20 rounded px-1",children:[t.textSize,"%"]})]})]})]})]})}),e.jsx("div",{className:"tournament-grid",children:e.jsx("div",{className:"tournament-main",children:e.jsx(ke,{})})}),e.jsx("div",{className:"mt-16 mb-24 w-full mx-auto px-4 max-w-7xl",children:e.jsx(Pe,{})})]})},Ue=()=>{const{state:t}=$(),s=t.schedule&&t.schedule.length>0;return T.useEffect(()=>he({title:"Padel Mexicano & Americano Generator | Tournament Scheduler",description:"Generate padel Mexicano and Americano schedules, auto-assign courts, and track live scores. Fast tournament setup from any device.",canonical:"https://padelcompanion.se/tournament/generator",ogUrl:"https://padelcompanion.se/tournament/generator"}),[]),e.jsxs("div",{className:"generator-page-wrapper tournament-page",children:[e.jsx(ne,{}),s?e.jsx(Ee,{}):e.jsx(Ce,{onGameActive:()=>{}}),!s&&e.jsx(ce,{})]})};export{Ue as default};
